@using BlazorWebFormsComponents.DataBinding
@inherits DataBoundComponent<ItemType>
@typeparam ItemType

<CascadingValue Name="ParentDetailsView" Value="this" IsFixed="true">
	@RowStyleContent
	@AlternatingRowStyleContent
	@HeaderStyleContent
	@FooterStyleContent
	@CommandRowStyleContent
	@EditRowStyleContent
	@InsertRowStyleContent
	@FieldHeaderStyleContent
	@EmptyDataRowStyleContent
	@PagerStyleContent
	@PagerSettingsContent
</CascadingValue>

@if (Visible)
{
	<table @attributes="AdditionalAttributes"
		   id="@ClientID"
		   cellspacing="0"
		   rules="@GridLinesAttribute"
		   border="@BorderAttribute"
		   style="@CombinedStyle"
		   class="@CssClass">

		@if (!string.IsNullOrEmpty(Caption))
		{
			<caption style="@GetCaptionStyle()">@Caption</caption>
		}

		@* Header Row *@
		@if (HeaderTemplate != null || !string.IsNullOrEmpty(HeaderText))
		{
			<tr style="@HeaderStyle?.ToString()">
				<td colspan="2">
					@if (HeaderTemplate != null)
					{
						@HeaderTemplate
					}
					else
					{
						@HeaderText
					}
				</td>
			</tr>
		}

		@if (CurrentItem != null)
		{
			var fieldList = GetFields();
			var rowIndex = 0;
			@foreach (var field in fieldList)
			{
				var isAlternating = rowIndex % 2 == 1;
				var currentRowStyle = GetRowStyle(rowIndex);
				<tr style="@currentRowStyle?.ToString()">
					<td style="@FieldHeaderStyle?.ToString()">@field.HeaderText</td>
					<td>@field.GetValue(CurrentItem, CurrentMode)</td>
				</tr>
				rowIndex++;
			}

			@* Command Row *@
			@if (ShowCommandRow)
			{
				<tr style="@CommandRowStyle?.ToString()">
					<td colspan="2">
						@switch (CurrentMode)
						{
							case Enums.DetailsViewMode.ReadOnly:
								@if (AutoGenerateEditButton)
								{
									<a href="javascript:void(0);" @onclick="@(() => ChangeMode(Enums.DetailsViewMode.Edit))" @onclick:preventDefault="true">Edit</a>
								}
								@if (AutoGenerateDeleteButton)
								{
									if (AutoGenerateEditButton) { <text>&nbsp;</text> }
									<a href="javascript:void(0);" @onclick="@HandleDelete" @onclick:preventDefault="true">Delete</a>
								}
								@if (AutoGenerateInsertButton)
								{
									if (AutoGenerateEditButton || AutoGenerateDeleteButton) { <text>&nbsp;</text> }
									<a href="javascript:void(0);" @onclick="@(() => ChangeMode(Enums.DetailsViewMode.Insert))" @onclick:preventDefault="true">New</a>
								}
								break;

							case Enums.DetailsViewMode.Edit:
								<a href="javascript:void(0);" @onclick="@HandleUpdate" @onclick:preventDefault="true">Update</a>
								<text>&nbsp;</text>
								<a href="javascript:void(0);" @onclick="@HandleCancel" @onclick:preventDefault="true">Cancel</a>
								break;

							case Enums.DetailsViewMode.Insert:
								<a href="javascript:void(0);" @onclick="@HandleInsert" @onclick:preventDefault="true">Insert</a>
								<text>&nbsp;</text>
								<a href="javascript:void(0);" @onclick="@HandleCancel" @onclick:preventDefault="true">Cancel</a>
								break;
						}
					</td>
				</tr>
			}

			@* Pager Row *@
			@if (AllowPaging && Items != null && Items.Count() > 1)
			{
				<tr style="@PagerStyle?.ToString()">
					<td colspan="2">
						@if (PagerTemplate != null)
						{
							@PagerTemplate
						}
						else
						{
							<table>
								<tr>
									@for (int i = 0; i < Items.Count(); i++)
									{
										var pageIndex = i;
										@if (i == PageIndex)
										{
											<td><span>@(i + 1)</span></td>
										}
										else
										{
											<td><a href="javascript:void(0);" @onclick="@(() => GoToPage(pageIndex))" @onclick:preventDefault="true">@(pageIndex + 1)</a></td>
										}
									}
								</tr>
							</table>
						}
					</td>
				</tr>
			}
		}
		else if (EmptyDataTemplate != null || !string.IsNullOrEmpty(EmptyDataText))
		{
			<tr style="@EmptyDataRowStyle?.ToString()">
				<td>
					@if (EmptyDataTemplate != null)
					{
						@EmptyDataTemplate
					}
					else
					{
						@EmptyDataText
					}
				</td>
			</tr>
		}

		@* Footer Row *@
		@if (FooterTemplate != null || !string.IsNullOrEmpty(FooterText))
		{
			<tr style="@FooterStyle?.ToString()">
				<td colspan="2">
					@if (FooterTemplate != null)
					{
						@FooterTemplate
					}
					else
					{
						@FooterText
					}
				</td>
			</tr>
		}
	</table>
}

@* Field definitions via child content *@
@if (Fields != null)
{
	<CascadingValue Value="this" Name="DetailsViewFieldCollection">
		@Fields
	</CascadingValue>
}
