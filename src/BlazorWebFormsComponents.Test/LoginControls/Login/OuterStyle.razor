@using System.Security.Claims
@using Microsoft.AspNetCore.Components.Authorization
@using BlazorWebFormsComponents.LoginControls
@using Moq

@code {

	private void SetupLoginServices()
	{
		var principal = new ClaimsPrincipal(new ClaimsIdentity());
		var authMock = new Mock<AuthenticationStateProvider>();
		authMock.Setup(x => x.GetAuthenticationStateAsync())
			.Returns(Task.FromResult(new AuthenticationState(principal)));
		Services.AddSingleton<AuthenticationStateProvider>(authMock.Object);

		var navMock = new Mock<NavigationManager>();
		Services.AddSingleton<NavigationManager>(navMock.Object);
	}

	[Fact]
	public void Login_CssClass_RendersOnOuterTable()
	{
		// Arrange
		SetupLoginServices();

		// Act
		var cut = Render(
			@<BlazorWebFormsComponents.LoginControls.Login ID="loginCtl" CssClass="login-panel" />
		);

		// Assert
		var table = cut.Find("table#loginCtl");
		table.ShouldNotBeNull();
		table.GetAttribute("class").ShouldBe("login-panel");
	}

	[Fact]
	public void Login_WithoutCssClass_NoClassOnOuterTable()
	{
		// Arrange
		SetupLoginServices();

		// Act
		var cut = Render(
			@<BlazorWebFormsComponents.LoginControls.Login ID="loginCtl2" />
		);

		// Assert
		var table = cut.Find("table#loginCtl2");
		table.HasAttribute("class").ShouldBeFalse();
	}

	[Fact]
	public void Login_InheritsBaseStyledComponent_StyleParameterAccepted()
	{
		// Arrange
		SetupLoginServices();

		// Act — verify BackColor parameter is accepted (from BaseStyledComponent)
		var cut = Render(
			@<BlazorWebFormsComponents.LoginControls.Login ID="loginCtl3" CssClass="styled" />
		);

		// Assert — no exception, component renders
		var table = cut.Find("table#loginCtl3");
		table.ShouldNotBeNull();
	}

}
