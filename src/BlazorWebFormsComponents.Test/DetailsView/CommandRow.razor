@using BlazorWebFormsComponents.Enums

@code {

	[Fact]
	public void DetailsView_AutoGenerateEditButton_RendersEditLink()
	{
		var items = Widget.SimpleWidgetList.Take(1).ToList();
		var cut = Render(@<DetailsView Items="items" ItemType="Widget" AutoGenerateEditButton="true" AutoGenerateRows="true" />);

		var links = cut.FindAll("a");
		links.Any(a => a.TextContent == "Edit").ShouldBeTrue("Expected an Edit link in command row");
	}

	[Fact]
	public void DetailsView_AutoGenerateDeleteButton_RendersDeleteLink()
	{
		var items = Widget.SimpleWidgetList.Take(1).ToList();
		var cut = Render(@<DetailsView Items="items" ItemType="Widget" AutoGenerateDeleteButton="true" AutoGenerateRows="true" />);

		var links = cut.FindAll("a");
		links.Any(a => a.TextContent == "Delete").ShouldBeTrue("Expected a Delete link in command row");
	}

	[Fact]
	public void DetailsView_AutoGenerateInsertButton_RendersNewLink()
	{
		var items = Widget.SimpleWidgetList.Take(1).ToList();
		var cut = Render(@<DetailsView Items="items" ItemType="Widget" AutoGenerateInsertButton="true" AutoGenerateRows="true" />);

		var links = cut.FindAll("a");
		links.Any(a => a.TextContent == "New").ShouldBeTrue("Expected a New link in command row");
	}

	[Fact]
	public void DetailsView_NoCommandButtons_NoCommandRow()
	{
		var items = Widget.SimpleWidgetList.Take(1).ToList();
		var cut = Render(@<DetailsView Items="items" ItemType="Widget" AutoGenerateRows="true" />);

		var links = cut.FindAll("a");
		links.Any(a => a.TextContent == "Edit").ShouldBeFalse();
		links.Any(a => a.TextContent == "Delete").ShouldBeFalse();
		links.Any(a => a.TextContent == "New").ShouldBeFalse();
	}

	[Fact]
	public void DetailsView_ClickEdit_SwitchesToEditMode()
	{
		var items = Widget.SimpleWidgetList.Take(1).ToList();
		var cut = Render(@<DetailsView Items="items" ItemType="Widget" AutoGenerateEditButton="true" AutoGenerateRows="true" />);

		var editLink = cut.FindAll("a").First(a => a.TextContent == "Edit");
		editLink.Click();

		// In edit mode, should show Update and Cancel links
		var links = cut.FindAll("a");
		links.Any(a => a.TextContent == "Update").ShouldBeTrue("Expected Update link in edit mode");
		links.Any(a => a.TextContent == "Cancel").ShouldBeTrue("Expected Cancel link in edit mode");
		links.Any(a => a.TextContent == "Edit").ShouldBeFalse("Edit link should not appear in edit mode");
	}

	[Fact]
	public void DetailsView_ClickNew_SwitchesToInsertMode()
	{
		var items = Widget.SimpleWidgetList.Take(1).ToList();
		var cut = Render(@<DetailsView Items="items" ItemType="Widget" AutoGenerateInsertButton="true" AutoGenerateRows="true" />);

		var newLink = cut.FindAll("a").First(a => a.TextContent == "New");
		newLink.Click();

		// In insert mode, should show Insert and Cancel links
		var links = cut.FindAll("a");
		links.Any(a => a.TextContent == "Insert").ShouldBeTrue("Expected Insert link in insert mode");
		links.Any(a => a.TextContent == "Cancel").ShouldBeTrue("Expected Cancel link in insert mode");
	}

	[Fact]
	public void DetailsView_ClickCancel_ReturnsToReadOnlyMode()
	{
		var items = Widget.SimpleWidgetList.Take(1).ToList();
		var cut = Render(@<DetailsView Items="items" ItemType="Widget" AutoGenerateEditButton="true" AutoGenerateRows="true" />);

		// Enter edit mode
		cut.FindAll("a").First(a => a.TextContent == "Edit").Click();
		// Click Cancel
		cut.FindAll("a").First(a => a.TextContent == "Cancel").Click();

		// Should be back to read-only with Edit link
		var links = cut.FindAll("a");
		links.Any(a => a.TextContent == "Edit").ShouldBeTrue("Expected Edit link after cancel");
		links.Any(a => a.TextContent == "Update").ShouldBeFalse("Update should not appear after cancel");
	}

	[Fact]
	public void DetailsView_AllCommandButtons_RendersAllThree()
	{
		var items = Widget.SimpleWidgetList.Take(1).ToList();
		var cut = Render(@<DetailsView Items="items" ItemType="Widget"
			AutoGenerateEditButton="true"
			AutoGenerateDeleteButton="true"
			AutoGenerateInsertButton="true"
			AutoGenerateRows="true" />);

		var links = cut.FindAll("a");
		links.Any(a => a.TextContent == "Edit").ShouldBeTrue();
		links.Any(a => a.TextContent == "Delete").ShouldBeTrue();
		links.Any(a => a.TextContent == "New").ShouldBeTrue();
	}
}
