@using BlazorWebFormsComponents.Enums

@code {

	[Fact]
	public void ShowHeader_False_HidesThead()
	{
		var data = GetTestItems();

		var cut = Render(@<GridView ItemType="DisplayTestItem" DataSource="data" AutoGenerateColumns="false"
						ShowHeader="false">
			<Columns>
				<BoundField ItemType="DisplayTestItem" DataField="Name" HeaderText="Name" />
			</Columns>
		</GridView>);

		cut.FindAll("thead").Count.ShouldBe(0);
	}

	[Fact]
	public void ShowFooter_True_ShowsTfoot()
	{
		var data = GetTestItems();

		var cut = Render(@<GridView ItemType="DisplayTestItem" DataSource="data" AutoGenerateColumns="false"
						ShowFooter="true">
			<Columns>
				<BoundField ItemType="DisplayTestItem" DataField="Name" HeaderText="Name" />
			</Columns>
		</GridView>);

		cut.FindAll("tfoot").Count.ShouldBe(1);
	}

	[Fact]
	public void Caption_RendersElement()
	{
		var data = GetTestItems();

		var cut = Render(@<GridView ItemType="DisplayTestItem" DataSource="data" AutoGenerateColumns="false"
						Caption="Test Caption">
			<Columns>
				<BoundField ItemType="DisplayTestItem" DataField="Name" HeaderText="Name" />
			</Columns>
		</GridView>);

		var caption = cut.Find("caption");
		caption.TextContent.ShouldBe("Test Caption");
	}

	[Fact]
	public void CaptionAlign_RendersCorrectStyle()
	{
		var data = GetTestItems();

		var cut = Render(@<GridView ItemType="DisplayTestItem" DataSource="data" AutoGenerateColumns="false"
						Caption="Test Caption" CaptionAlign="TableCaptionAlign.Bottom">
			<Columns>
				<BoundField ItemType="DisplayTestItem" DataField="Name" HeaderText="Name" />
			</Columns>
		</GridView>);

		cut.Find("caption").GetAttribute("style").ShouldBe("caption-side:bottom");
	}

	[Fact]
	public void EmptyDataTemplate_RendersCustomContent()
	{
		var emptyList = new List<DisplayTestItem>();

		var cut = Render(@<GridView ItemType="DisplayTestItem" Items="emptyList" AutoGenerateColumns="true"
						EmptyDataText="Fallback text">
			<EmptyDataTemplate>
				<p class="custom-empty">No records found</p>
			</EmptyDataTemplate>
		</GridView>);

		cut.Find("p.custom-empty").TextContent.ShouldBe("No records found");
		cut.Markup.ShouldNotContain("Fallback text");
	}

	[Fact]
	public void GridLines_RendersRulesAttribute()
	{
		var data = GetTestItems();

		var cut = Render(@<GridView ItemType="DisplayTestItem" DataSource="data" AutoGenerateColumns="false"
						GridLines="GridLines.Both">
			<Columns>
				<BoundField ItemType="DisplayTestItem" DataField="Name" HeaderText="Name" />
			</Columns>
		</GridView>);

		cut.Find("table").GetAttribute("rules").ShouldBe("all");
	}

	[Fact]
	public void UseAccessibleHeader_RendersThWithScope()
	{
		var data = GetTestItems();

		var cut = Render(@<GridView ItemType="DisplayTestItem" DataSource="data" AutoGenerateColumns="false"
						UseAccessibleHeader="true">
			<Columns>
				<BoundField ItemType="DisplayTestItem" DataField="Id" HeaderText="ID" />
				<BoundField ItemType="DisplayTestItem" DataField="Name" HeaderText="Name" />
			</Columns>
		</GridView>);

		var headers = cut.FindAll("th");
		foreach (var header in headers)
		{
			header.GetAttribute("scope").ShouldBe("col");
		}
	}

	[Fact]
	public void CellPadding_CellSpacing_RenderAttributes()
	{
		var data = GetTestItems();

		var cut = Render(@<GridView ItemType="DisplayTestItem" DataSource="data" AutoGenerateColumns="false"
						CellPadding="5" CellSpacing="3">
			<Columns>
				<BoundField ItemType="DisplayTestItem" DataField="Name" HeaderText="Name" />
			</Columns>
		</GridView>);

		cut.Find("table").GetAttribute("cellpadding").ShouldBe("5");
		cut.Find("table").GetAttribute("cellspacing").ShouldBe("3");
	}

	[Fact]
	public void ShowHeaderWhenEmpty_ShowsHeaderWithNoData()
	{
		var emptyList = new List<DisplayTestItem>();

		var cut = Render(@<GridView ItemType="DisplayTestItem" Items="emptyList" AutoGenerateColumns="true"
						ShowHeaderWhenEmpty="true" EmptyDataText="No data">
		</GridView>);

		cut.FindAll("thead").Count.ShouldBe(1);
		cut.FindAll("th").Count.ShouldBeGreaterThan(0);
	}

	private List<DisplayTestItem> GetTestItems()
	{
		return new List<DisplayTestItem>
		{
			new DisplayTestItem { Id = 1, Name = "Alpha" },
			new DisplayTestItem { Id = 2, Name = "Beta" },
			new DisplayTestItem { Id = 3, Name = "Gamma" }
		};
	}

	public class DisplayTestItem
	{
		public int Id { get; set; }
		public string Name { get; set; }
	}
}
