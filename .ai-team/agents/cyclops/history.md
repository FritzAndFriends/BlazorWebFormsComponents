# Project Context

- **Owner:** Jeffrey T. Fritz (csharpfritz@users.noreply.github.com)
- **Project:** BlazorWebFormsComponents â€” Blazor components emulating ASP.NET Web Forms controls for migration
- **Stack:** C#, Blazor, .NET, ASP.NET Web Forms, bUnit, xUnit, MkDocs, Playwright
- **Created:** 2026-02-10

## Learnings

<!-- Append new learnings below. Each entry is something lasting about the project. -->
<!-- âš  Summarized 2026-02-23 by Scribe â€” original entries covered 2026-02-10 through 2026-02-12 -->

### Summary: Milestones 1â€“3 Implementation (2026-02-10 through 2026-02-12)

Built Calendar (enum fix, async events), ImageMap (BaseStyledComponent, Guid IDs, Enabled propagation), FileUpload (InputFile integration, path sanitization), PasswordRecovery (3-step wizard, per-step EditForm, SubmitButtonStyleâ†’LoginButtonStyle cascading), DetailsView (DataBoundComponent<T>, auto-field reflection, mode switching, 10 events, paging). Image and Label upgraded to BaseStyledComponent (WI-15/WI-17).

**Key patterns:** Enum files in `Enums/` with explicit int values. Instance-based Guid IDs (not static). `_ = callback.InvokeAsync()` for render-time events. `Path.GetFileName()` for file save security. Login controls inherit BaseWebFormsComponent with CascadingParameter styles.

### Summary: Milestone 4 Chart Component (2026-02-12)

Chart uses BaseStyledComponent, CascadingValue `"ParentChart"` for child registration. JS interop via separate `ChartJsInterop` (not shared service). `ChartConfigBuilder` is pure static class for testability. ChartWidth/ChartHeight as strings (avoid base Width/Height conflict). SeriesChartType.Point â†’ Chart.js "scatter". 8 Phase 1 types; unsupported throw NotSupportedException. ChartSeries data binding via reflection on Items/XValueMember/YValueMembers.

### Summary: Feature Audit â€” Editor Controls Aâ€“I (2026-02-23)

Audited 13 controls. Found: AccessKey/ToolTip missing from base class (universal gap), Image needs BaseStyledComponent, HyperLink.NavigateUrl naming mismatch, list controls missing DataTextFormatString/AppendDataBoundItems/CausesValidation/ValidationGroup, Calendar styles use CSS strings instead of TableItemStyle objects.

ðŸ“Œ Team update (2026-02-12): DetailsView auto-generated fields must render <input type="text"> in Edit/Insert mode â€” decided by Cyclops

- **DataBoundComponent style inheritance (WI-07):** Changed `BaseDataBoundComponent` to inherit `BaseStyledComponent` instead of `BaseWebFormsComponent`. This gives ALL data controls (GridView, DetailsView, FormView, ListView, DataGrid, DataList, Repeater, TreeView, AdRotator, BulletedList, CheckBoxList, DropDownList, ListBox, RadioButtonList) the full IStyle property set (BackColor, CssClass, ForeColor, Font, etc.) from the base class. Removed duplicate IStyle implementations and CssClass properties from: GridView, DetailsView, DataGrid, DataList, TreeView, AdRotator, BulletedList, CheckBoxList, DropDownList, ListBox, RadioButtonList. DataList kept its `new string Style` parameter (user-supplied CSS) but removed its IStyle declaration and 9 duplicate style properties. ListView kept its obsolete `new string Style` parameter. FormView and Repeater needed no changes.
- **CausesValidation pattern for non-button controls (WI-49):** CheckBox, RadioButton, and TextBox now have `CausesValidation` (bool, default true), `ValidationGroup` (string), and a `[CascadingParameter(Name = "ValidationGroupCoordinator")] ValidationGroupCoordinator Coordinator` â€” identical to the pattern in `ButtonBaseComponent`. Validation is triggered in the existing `HandleChange` method for CheckBox/RadioButton. TextBox has the parameters but no handler wiring because the component has no `@onchange` binding in its template.
- **BaseListControl<TItem> base class (WI-47/48):** Created `DataBinding/BaseListControl.cs` inheriting `DataBoundComponent<TItem>`. Consolidates `StaticItems`, `DataTextField`, `DataValueField`, `GetItems()`, and `GetPropertyValue()` from all 5 list controls (BulletedList, CheckBoxList, DropDownList, ListBox, RadioButtonList). All 5 now inherit `BaseListControl<TItem>`. This mirrors Web Forms `ListControl` as the shared base.
- **DataTextFormatString (WI-47):** `[Parameter] public string DataTextFormatString` on `BaseListControl<TItem>`. Applied via `string.Format(DataTextFormatString, text)` at render time in `GetItems()`, not at bind time. Affects both static and data-bound items. Static items get a cloned `ListItem` to avoid mutating the source collection.
- **AppendDataBoundItems (WI-48):** `[Parameter] public bool AppendDataBoundItems` on `BaseListControl<TItem>`, default `false`. When `false` and `Items != null`, static items are skipped in `GetItems()`. When `true`, static items always render before data-bound items. Matches Web Forms semantics where `DataBind()` clears `Items` by default.
- **List control inheritance chain:** `BaseListControl<TItem>` â†’ `DataBoundComponent<TItem>` â†’ `BaseDataBoundComponent` â†’ `BaseStyledComponent` â†’ `BaseWebFormsComponent`. All list controls get full style property set via this chain.
- **Orientation enum and Menu orientation (WI-50):** Created `Enums/Orientation.cs` (Horizontal=0, Vertical=1) using file-scoped namespace. Menu.razor.cs gets `[Parameter] public Orientation Orientation { get; set; } = Orientation.Vertical;`. Horizontal layout achieved via CSS class `horizontal` on the top-level `<ul>`, with `display: inline-block` on direct `<li>` children. JS interop orientation string made dynamic from enum value.
- **Label AssociatedControlID (WI-51):** When `AssociatedControlID` is set (non-null/non-empty), Label renders `<label for="{AssociatedControlID}">` instead of `<span>`. All existing attributes (id, class, style, accesskey) apply to whichever element renders. This matches Web Forms behavior where `Label.AssociatedControlID` switches the output element. Important for accessibility â€” `<label for>` enables screen readers.
- **Login controls upgraded to BaseStyledComponent (WI-52):** Login, ChangePassword, and CreateUserWizard now inherit `BaseStyledComponent` instead of `BaseWebFormsComponent`. This adds BackColor, BorderColor, BorderStyle, BorderWidth, CssClass, Font, ForeColor, Height, Width to the outer `<table>` element. No conflicts with CascadingParameter sub-styles (TitleTextStyle, LabelStyle, etc.) because outer styles are `[Parameter]` and sub-styles are `[CascadingParameter]` â€” completely independent mechanisms. `SetFontsFromAttributes` called in `HandleUnknownAttributes` for Font-* attribute support. The `GetCssClassOrNull()` helper returns null when empty so the `class` attribute is omitted from HTML when no CssClass is set.
- **Menu core improvements (WI-19/WI-21/WI-23):** Menu now inherits `BaseStyledComponent` instead of `BaseWebFormsComponent`, gaining all IStyle properties rendered on the root `<div>`. Added selection tracking: `SelectedItem` (MenuItem), `SelectedValue` (string), `MenuItemClick` (EventCallback<MenuEventArgs>), `MenuItemDataBound` (EventCallback<MenuEventArgs>). New `MenuEventArgs` class follows `TreeNodeEventArgs` pattern. MenuItem gets `Value`, `Target`, `ValuePath`, `EffectiveTarget` (item Target > Menu Target fallback), and `HandleClick` (notifies parent). Added `MaximumDynamicDisplayLevels` (int, default 3), `Target` (string), `SkipLinkText` (string, default "Skip Navigation Links" â€” renders skip link pair), `PathSeparator` (char, default '/'). MenuItem `target` attribute changed from hardcoded `_blank` to `@EffectiveTarget`.

 Team update (2026-02-23): Menu Orientation Orientation parameter collides with enum type name in Razor  samples must use local variable with fully-qualified type  decided by Jubilee
 Team update (2026-02-23): P2 test observation  Login/ChangePassword/CreateUserWizard already inherit BaseStyledComponent, so WI-52 may have been a no-op or template-only change  decided by Rogue
- **Validator ControlToValidate string ID support (WI-36):** Renamed `ForwardRef<InputBase<Type>> ControlToValidate` parameter to `ControlRef` on `BaseValidator<Type>`. Added `[Parameter] public string ControlToValidate` as a string parameter matching the Web Forms migration pattern `ControlToValidate="TextBox1"`. When `ControlRef` (ForwardRef) is set, it takes precedence and uses the existing `ValueExpression`â†’`MemberExpression` path. When only `ControlToValidate` (string) is set, the validator resolves the field name directly and reads the value from `EditContext.Model` via reflection (`GetProperty`/`GetField`). This avoids JS interop â€” validation stays entirely server-side. Updated 38 test files, 8 sample files, and Login.razor from `ControlToValidate=` to `ControlRef=` for ForwardRef usage. All 5 validators (RequiredFieldValidator, CompareValidator, RangeValidator, RegularExpressionValidator, CustomValidator) inherit the dual-path support from BaseValidator.
 Team update (2026-02-23): Milestone 6 Work Plan ratified  54 WIs across P0/P1/P2 tiers targeting ~345 feature gaps  decided by Forge
 Team update (2026-02-23): UI overhaul requested  ComponentCatalog (UI-2) and search (UI-8) assigned to Cyclops  decided by Jeffrey T. Fritz
- **TreeView node-level style sub-components (WI-11):** Created `TreeNodeStyle` class extending `Style` with 5 TreeView-specific properties: `ChildNodesPadding`, `HorizontalPadding`, `ImageUrl`, `NodeSpacing`, `VerticalPadding` (all Unit except ImageUrl string). Created `ITreeViewStyleContainer` interface with 6 `TreeNodeStyle` properties (NodeStyle, HoverNodeStyle, LeafNodeStyle, ParentNodeStyle, RootNodeStyle, SelectedNodeStyle). TreeView implements the interface with `public TreeNodeStyle Xxx { get; internal set; } = new TreeNodeStyle()` pattern + 6 `[Parameter] RenderFragment XxxStyleContent` parameters. Created `UiTreeNodeStyle` abstract base (mirrors `UiTableItemStyle`). Created 6 sub-component pairs: TreeViewNodeStyle, TreeViewHoverNodeStyle, TreeViewLeafNodeStyle, TreeViewParentNodeStyle, TreeViewRootNodeStyle, TreeViewSelectedNodeStyle. Style resolution: `GetNodeStyle(node)` applies SelectedNodeStyle > type-specific > NodeStyle fallback. `GetNodeCssClass(node)` and `GetStyleImageUrl(node)` follow same priority.
- **TreeView selection support (WI-13):** Added `SelectedNode` (TreeNode, read-only), `SelectedValue` (string, returns SelectedNode.Value), `SelectedNodeChanged` (EventCallback<TreeNodeEventArgs>). `SelectNodeAsync(TreeNode)` deselects previous node, selects new, fires callback, and calls StateHasChanged. TreeNode.razor wires `@onclick="HandleNodeSelect"` on the text `<a>` element with `@onclick:preventDefault` when no NavigateUrl. Selected node gets inline `font-weight:bold` plus SelectedNodeStyle CSS from the style system. Keyboard handler (Enter/Space) also triggers selection.
- **TreeView expand/collapse methods + properties (WI-15):** Added `ExpandAll()` and `CollapseAll()` public methods that recursively traverse all nodes. `FindNode(string valuePath)` navigates the tree by `PathSeparator`-delimited path using Value (falls back to Text). `ExpandDepth` (int, default -1 meaning fully expanded) limits initial expansion â€” applied in TreeNode.OnInitializedAsync. `NodeIndent` (int, default 20) controls pixel indent per depth level â€” wired into the indent `<div>` width in TreeNode.razor. `PathSeparator` (char, default '/') used by FindNode and the new `ValuePath` property on TreeNode. TreeNode exposes public `ChildNodes` (IEnumerable<TreeNode>), `IsRootNode`, `IsParentNode`, `IsLeafNode`, `SetExpanded(bool)` for programmatic control.
- **GridView display properties (WI-07):**Added 10 display/layout parameters: `ShowHeader` (bool, default true), `ShowFooter` (bool, default false), `ShowHeaderWhenEmpty` (bool, default false), `Caption` (string), `CaptionAlign` (TableCaptionAlign enum), `EmptyDataTemplate` (RenderFragment), `GridLines` (GridLines enum), `UseAccessibleHeader` (bool, default false), `CellPadding` (int, default -1), `CellSpacing` (int, default -1). Both `GridLines` and `TableCaptionAlign` enums already existed in `Enums/`. Rendering: `<table>` gets `rules`/`cellpadding`/`cellspacing` attributes (null-suppressed when default). Caption renders `<caption>` with CSS `caption-side` or `text-align` from CaptionAlign. `ShouldRenderHeader` = `ShowHeader && (HasData || ShowHeaderWhenEmpty)` â€” this is a behavior change from always-show-header. `ShowFooter` adds a `<tfoot>` row with FooterStyle, combined with existing paging tfoot. `UseAccessibleHeader` adds `scope="col"` to existing `<th>` elements. `EmptyDataTemplate` takes precedence over `EmptyDataText` when both set. Updated `EmptyDataText` test to use `ShowHeaderWhenEmpty="true"` since it explicitly tested header with empty data.
- **GridView style sub-components (WI-05):** Created `IGridViewStyleContainer` interface with 8 `TableItemStyle` properties (RowStyle, AlternatingRowStyle, HeaderStyle, FooterStyle, EmptyDataRowStyle, PagerStyle, EditRowStyle, SelectedRowStyle). GridView implements the interface with `public TableItemStyle Xxx { get; internal set; } = new TableItemStyle()` pattern + 8 `[Parameter] RenderFragment XxxStyleContent` parameters. Created 8 sub-component pairs (`.razor` + `.razor.cs`): GridViewRowStyle, GridViewAlternatingRowStyle, GridViewHeaderStyle, GridViewFooterStyle, GridViewEmptyDataRowStyle, GridViewPagerStyle, GridViewEditRowStyle, GridViewSelectedRowStyle. Each inherits `UiTableItemStyle`, uses `[CascadingParameter(Name = "ParentGridView")] IGridViewStyleContainer`, and sets `theStyle` in `OnInitialized`. GridView.razor wraps style content in `<CascadingValue Name="ParentGridView" Value="this" IsFixed="true">`. Styles applied via `style="@XxxStyle?.ToString()"` on `<tr>` elements. `GetRowStyle(rowIndex)` resolves EditRowStyle > SelectedRowStyle > AlternatingRowStyle > RowStyle priority. RowStyle passed to `GridViewRow` via new `[Parameter] TableItemStyle RowStyle`. Follows exact same pattern as Calendar + CalendarDayStyle.
- **DetailsView style sub-components (WI-26):** Created `IDetailsViewStyleContainer` interface with 10 `TableItemStyle` properties (RowStyle, AlternatingRowStyle, HeaderStyle, FooterStyle, CommandRowStyle, EditRowStyle, InsertRowStyle, FieldHeaderStyle, EmptyDataRowStyle, PagerStyle). DetailsView implements the interface following the exact GridView pattern. Created 10 sub-component pairs: DetailsViewRowStyle, DetailsViewAlternatingRowStyle, DetailsViewHeaderStyle, DetailsViewFooterStyle, DetailsViewCommandRowStyle, DetailsViewEditRowStyle, DetailsViewInsertRowStyle, DetailsViewFieldHeaderStyle, DetailsViewEmptyDataRowStyle, DetailsViewPagerStyle. Each inherits `UiTableItemStyle` with `[CascadingParameter(Name = "ParentDetailsView")]`. DetailsView.razor wraps style content in `<CascadingValue Name="ParentDetailsView" Value="this" IsFixed="true">`. `GetRowStyle(rowIndex)` resolves EditRowStyle/InsertRowStyle > AlternatingRowStyle > RowStyle. FieldHeaderStyle applied to the first `<td>` (header cell) of each data row.
- **DetailsView Caption + PageCount (WI-28):** Added `Caption` (string), `CaptionAlign` (TableCaptionAlign enum, default NotSet), `PageCount` (int, computed from Items.Count()). Caption renders `<caption>` element with CSS from `GetCaptionStyle()` â€” same pattern as GridView. `GetCaptionStyle()` maps TableCaptionAlign values to `caption-side` or `text-align` CSS.
- **FormView remaining events (WI-31):** Added `ModeChanged` (EventCallback<FormViewModeEventArgs>) â€” fires after mode transition completes in every command handler (cancel, edit, insert, update). Added `ItemCommand` (EventCallback<FormViewCommandEventArgs>) â€” fires for all commands before specific handling. Created `FormViewCommandEventArgs` extending `CommandEventArgs`. Added `ItemCreated` (EventCallback) â€” fires on first render in `OnAfterRenderAsync`. Added `PageIndexChanging` and `PageIndexChanged` (EventCallback<PageChangedEventArgs>) â€” with cancellation support via `Cancel` property. Added "page" command handler in `HandleCommandArgs` supporting "next"/"prev"/"first"/"last"/numeric page arguments.
- **FormView style sub-components + Pager + Caption (WI-33):** Created `IFormViewStyleContainer` interface with 7 properties (RowStyle, EditRowStyle, InsertRowStyle, HeaderStyle, FooterStyle, EmptyDataRowStyle, PagerStyle). FormView implements the interface. Created 7 sub-component pairs: FormViewRowStyle, FormViewEditRowStyle, FormViewInsertRowStyle, FormViewHeaderStyle, FormViewFooterStyle, FormViewEmptyDataRowStyle, FormViewPagerStyle. Each uses `[CascadingParameter(Name = "ParentFormView")]`. Added `PagerTemplate` (RenderFragment) â€” when set, replaces default numeric pager. Added `Caption` (string) and `CaptionAlign` (TableCaptionAlign). `GetCurrentRowStyle()` resolves EditRowStyle/InsertRowStyle > RowStyle based on CurrentMode. Styles applied via `style="@XxxStyle?.ToString()"` on `<tr>` elements.
- **GridView selection support (WI-02):** Added `SelectedIndex` (int, default -1), `AutoGenerateSelectButton` (bool, default false), `SelectedIndexChanging` (EventCallback<GridViewSelectEventArgs>), `SelectedIndexChanged` (EventCallback<int>). `SelectedRow` returns the data item at `SelectedIndex` from `PagedItems`. `SelectedValue` uses reflection on `DataKeyNames` first key field. `SelectRow(int)` method follows the same pattern as `EditRow`: fires `SelectedIndexChanging`, checks `Cancel`, updates `SelectedIndex`, fires `SelectedIndexChanged`. `ShowCommandColumn` updated to include `AutoGenerateSelectButton`. `GetRowStyle` priority: EditRowStyle > SelectedRowStyle > AlternatingRowStyle > RowStyle. `GridViewRow` gets `IsSelected` parameter. When `AutoGenerateSelectButton=true`, a "Select" link renders in the command column before Edit/Delete. `GridViewSelectEventArgs` has `NewSelectedIndex` (int) + `Cancel` (bool), matching `GridViewEditEventArgs` pattern. `GridViewSelectedRowStyle` child component already existed from WI-05; `IGridViewStyleContainer.SelectedRowStyle` property was added in that same WI.
